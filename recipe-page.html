<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Recipes</title>
    <!-- Link to external CSS -->
    <link rel="stylesheet" href="/css/styles.css">
</head>

<body>
    <div class="container">
        <div class="recipe-header">
            <h1 id="recipe-name"></h1>
        </div>
        <div class="recipe-details">
            <div class="section">
                <h2>Description</h2>
                <p id="recipe-description"></p>
            </div>
            <div class="section">
                <h2>Instructions</h2>
                <ol id="instructions"></ol>
            </div>
        </div>
    </div>

    <script>
        const detailUrl = 'https://tasty.p.rapidapi.com/recipes/list?from=0&size=20&tags=under_30_minutes';
        const options = {
            method: 'GET',
            headers: {
                'x-rapidapi-key': '013542abafmsh5976ece5ebd9948p17873bjsn94fb3fc49a29',
                'x-rapidapi-host': 'tasty.p.rapidapi.com'
            }
        };

        async function fetchRecipeDetails(id) {
            try {
                const url = `${detailUrl}?id=${id}`;
                const response = await fetch(url, options);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const data = await response.json();
                return data;
            } catch (error) {
                console.error("Error fetching recipe details:", error);
                return null;
            }
        }

        function displayRecipeDetails(recipe) {
            document.getElementById('recipe-name').textContent = recipe.name;
            document.getElementById('recipe-description').textContent = recipe.description || "No description available.";

            const instructionsList = document.getElementById('instructions');
            instructionsList.innerHTML = ""; // Clear any previous instructions

            if (recipe.instructions && recipe.instructions.length > 0) {
                recipe.instructions.forEach(instruction => {
                    const listItem = document.createElement('li');
                    listItem.textContent = instruction.display_text;
                    instructionsList.appendChild(listItem);
                });
            } else {
                instructionsList.innerHTML = "<li>No instructions available.</li>";
            }
        }


        function displayError(message) {
            const recipeDetails = document.querySelector('.recipe-details');
            recipeDetails.innerHTML = `<p class="error-message">${message}</p>`;
        }



        window.addEventListener('DOMContentLoaded', async () => {
            const recipeId = localStorage.getItem('selectedRecipeId');
            if (!recipeId) {
                displayError("No recipe selected.");
                return;
            }

            const detailedRecipe = await fetchRecipeDetails(recipeId);

            if (detailedRecipe) {
                displayRecipeDetails(detailedRecipe);

            } else {
                displayError("Error loading recipe details.");
            }
        });
    </script>
</body>

</html>